t2018 <- read.csv("./data/Accidentalidad_georreferenciada_2018.csv")
t2018 <- select(t2018,5, 16)
t2018$FECHA <- substring(t2018$FECHA, 6,10)
porComuna2014 <- group_by(t2014, COMUNA, FECHA)
porComuna2014 <- summarize(porComuna2014, AÑO_2014 = n())
porComuna2015 <- group_by(t2015, COMUNA, FECHA)
porComuna2015 <- summarize(porComuna2015, AÑO_2015 = n())
porComuna2016 <- group_by(t2016, COMUNA, FECHA)
porComuna2016 <- summarize(porComuna2016, AÑO_2016 = n())
porComuna2017 <- group_by(t2017, COMUNA, FECHA)
porComuna2017 <- summarize(porComuna2017, AÑO_2017 = n())
porComuna2018 <- group_by(t2018, COMUNA, FECHA)
porComuna2018 <- summarize(porComuna2018, AÑO_2018 = n())
#Join de tablas
PorComunaT <- merge(porComuna2014, porComuna2015, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2016, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2017, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2018, by = c("COMUNA","FECHA"))
PorComunaT[is.na(PorComunaT)] <- 0
View(porComuna2018)
PorComunaT <- merge(porComuna2014, porComuna2015, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2016, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2017, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2018, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT[is.na(PorComunaT)] <- 0
View(PorComunaT)
t2014 <- read.csv("./data/Accidentalidad_georreferenciada_2014.csv", )
t2014 <- select(t2014,5, 15)
t2014$FECHA <- substring(t2014$FECHA, 6,10)
t2015 <- read.csv("./data/Accidentalidad_georreferenciada_2015.csv")
t2015 <- select(t2015,5, 15)
t2015$FECHA <- substring(t2015$FECHA, 6,10)
t2016 <- read.csv("./data/Accidentalidad_georreferenciada_2016.csv")
t2016 <- select(t2016,5, 15)
t2016$FECHA <- substring(t2016$FECHA, 6,10)
t2017 <- read.csv("./data/Accidentalidad_georreferenciada_2017.csv")
t2017 <- select(t2017,5, 15)
t2017$FECHA <- substring(t2017$FECHA, 6,10)
t2018 <- read.csv("./data/Accidentalidad_georreferenciada_2018.csv")
t2018 <- select(t2018,5, 15)
t2018$FECHA <- substring(t2018$FECHA, 6,10)
porBarrio2014 <- group_by(t2014, BARRIO, FECHA)
porBarrio2014 <- summarize(porBarrio2014, AÑO_2014 = n())
porBarrio2015 <- group_by(t2015, BARRIO, FECHA)
porBarrio2015 <- summarize(porBarrio2015, AÑO_2015 = n())
porBarrio2016 <- group_by(t2016, BARRIO, FECHA)
porBarrio2016 <- summarize(porBarrio2016, AÑO_2016 = n())
porBarrio2017 <- group_by(t2017, BARRIO, FECHA)
porBarrio2017 <- summarize(porBarrio2017, AÑO_2017 = n())
porBarrio2018 <- group_by(t2018, BARRIO, FECHA)
porBarrio2018 <- summarize(porBarrio2018, AÑO_2018 = n())
#Join de tablas
PorBarrioT <- merge(porBarrio2014, porBarrio2015, by = c("BARRIO","FECHA"), all = TRUE)
PorBarrioT <- merge(PorBarrioT, porBarrio2016, by = c("BARRIO","FECHA"), all = TRUE)
PorBarrioT <- merge(PorBarrioT, porBarrio2017, by = c("BARRIO","FECHA"), all = TRUE)
PorBarrioT <- merge(PorBarrioT, porBarrio2018, by = c("BARRIO","FECHA"))
PorBarrioT[is.na(PorBarrioT)] <- 0
########################################################################################################
mse_k2018<-function(k,data_tr,data_vl,formula_mod){
adv_knn<-knnreg(formula_mod,data=datos_tr,k=k)
y_tr_pred<-predict(adv_knn,datos_tr)
mse_tr<-mean((datos_tr$AÑO_2018-y_tr_pred)^2)
y_vl_pred<-predict(adv_knn,datos_vl)
mse_vl<-mean((datos_vl$AÑO_2018-y_vl_pred)^2)
return(list(mse_tr=mse_tr,mse_vl=mse_vl))
}
set.seed(98956561)
diario2018 <- function(datos){
p_tr<-0.6
N_datos<-dim(datos)[1]
n_tr<-round(N_datos*p_tr)
ix_tr<-sample(N_datos,n_tr,replace = FALSE)
datos_tr<-datos[ix_tr,]
datos_vl<-datos[-ix_tr,]
modelo <- formula("AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017")
num_vec<-1:1000
tryCatch( { MSE <- lapply(num_vec,mse_k2018,data_tr=data_tr,data_vl = data_vl,formula_mod = modelo)}, error = function(e) {an.error.occured <<- TRUE})
num_vec <- (1:length(MSE))
mse_tr<-sapply(num_vec,function(x,y){`[[`(y,x)$mse_tr},y=MSE)
mse_vl<-sapply(num_vec,function(x,y){`[[`(y,x)$mse_vl},y=MSE)
new_k <- which.min(abs(mse_tr-mse_vl))
return(new_k)
}
diario2018(PorBarrioT)
diario2018(cargarComuna)
#Cargar datos de comuna
cargarComuna <- function(){
t2014 <- read.csv("./data/Accidentalidad_georreferenciada_2014.csv", )
t2014 <- select(t2014,5, 16)
t2014$FECHA <- substring(t2014$FECHA, 6,10)
t2015 <- read.csv("./data/Accidentalidad_georreferenciada_2015.csv")
t2015 <- select(t2015,5, 16)
t2015$FECHA <- substring(t2015$FECHA, 6,10)
t2016 <- read.csv("./data/Accidentalidad_georreferenciada_2016.csv")
t2016 <- select(t2016,5, 16)
t2016$FECHA <- substring(t2016$FECHA, 6,10)
t2017 <- read.csv("./data/Accidentalidad_georreferenciada_2017.csv")
t2017 <- select(t2017,5, 16)
t2017$FECHA <- substring(t2017$FECHA, 6,10)
t2018 <- read.csv("./data/Accidentalidad_georreferenciada_2018.csv")
t2018 <- select(t2018,5, 16)
t2018$FECHA <- substring(t2018$FECHA, 6,10)
porComuna2014 <- group_by(t2014, COMUNA, FECHA)
porComuna2014 <- summarize(porComuna2014, AÑO_2014 = n())
porComuna2015 <- group_by(t2015, COMUNA, FECHA)
porComuna2015 <- summarize(porComuna2015, AÑO_2015 = n())
porComuna2016 <- group_by(t2016, COMUNA, FECHA)
porComuna2016 <- summarize(porComuna2016, AÑO_2016 = n())
porComuna2017 <- group_by(t2017, COMUNA, FECHA)
porComuna2017 <- summarize(porComuna2017, AÑO_2017 = n())
porComuna2018 <- group_by(t2018, COMUNA, FECHA)
porComuna2018 <- summarize(porComuna2018, AÑO_2018 = n())
#Join de tablas
PorComunaT <- merge(porComuna2014, porComuna2015, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2016, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2017, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2018, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT[is.na(PorComunaT)] <- 0
return(PorComunaT)
}
diario2018(cargarComuna)
diario2018(cargarComuna())
View(mse_k)
cargarComuna()
cargarComuna <- function(){
t2014 <- read.csv("./data/Accidentalidad_georreferenciada_2014.csv", )
t2014 <- select(t2014,5, 16)
t2014$FECHA <- substring(t2014$FECHA, 6,10)
t2015 <- read.csv("./data/Accidentalidad_georreferenciada_2015.csv")
t2015 <- select(t2015,5, 16)
t2015$FECHA <- substring(t2015$FECHA, 6,10)
t2016 <- read.csv("./data/Accidentalidad_georreferenciada_2016.csv")
t2016 <- select(t2016,5, 16)
t2016$FECHA <- substring(t2016$FECHA, 6,10)
t2017 <- read.csv("./data/Accidentalidad_georreferenciada_2017.csv")
t2017 <- select(t2017,5, 16)
t2017$FECHA <- substring(t2017$FECHA, 6,10)
t2018 <- read.csv("./data/Accidentalidad_georreferenciada_2018.csv")
t2018 <- select(t2018,5, 16)
t2018$FECHA <- substring(t2018$FECHA, 6,10)
porComuna2014 <- group_by(t2014, COMUNA, FECHA)
porComuna2014 <- summarize(porComuna2014, AÑO_2014 = n())
porComuna2015 <- group_by(t2015, COMUNA, FECHA)
porComuna2015 <- summarize(porComuna2015, AÑO_2015 = n())
porComuna2016 <- group_by(t2016, COMUNA, FECHA)
porComuna2016 <- summarize(porComuna2016, AÑO_2016 = n())
porComuna2017 <- group_by(t2017, COMUNA, FECHA)
porComuna2017 <- summarize(porComuna2017, AÑO_2017 = n())
porComuna2018 <- group_by(t2018, COMUNA, FECHA)
porComuna2018 <- summarize(porComuna2018, AÑO_2018 = n())
#Join de tablas
PorComunaT <- merge(porComuna2014, porComuna2015, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2016, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2017, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT <- merge(PorComunaT, porComuna2018, by = c("COMUNA","FECHA"), all = TRUE)
PorComunaT[is.na(PorComunaT)] <- 0
return(PorComunaT)
}
cargarBarrio <- function(){
t2014 <- read.csv("./data/Accidentalidad_georreferenciada_2014.csv", )
t2014 <- select(t2014,5, 15)
t2014$FECHA <- substring(t2014$FECHA, 6,10)
t2015 <- read.csv("./data/Accidentalidad_georreferenciada_2015.csv")
t2015 <- select(t2015,5, 15)
t2015$FECHA <- substring(t2015$FECHA, 6,10)
t2016 <- read.csv("./data/Accidentalidad_georreferenciada_2016.csv")
t2016 <- select(t2016,5, 15)
t2016$FECHA <- substring(t2016$FECHA, 6,10)
t2017 <- read.csv("./data/Accidentalidad_georreferenciada_2017.csv")
t2017 <- select(t2017,5, 15)
t2017$FECHA <- substring(t2017$FECHA, 6,10)
t2018 <- read.csv("./data/Accidentalidad_georreferenciada_2018.csv")
t2018 <- select(t2018,5, 15)
t2018$FECHA <- substring(t2018$FECHA, 6,10)
porBarrio2014 <- group_by(t2014, BARRIO, FECHA)
porBarrio2014 <- summarize(porBarrio2014, AÑO_2014 = n())
porBarrio2015 <- group_by(t2015, BARRIO, FECHA)
porBarrio2015 <- summarize(porBarrio2015, AÑO_2015 = n())
porBarrio2016 <- group_by(t2016, BARRIO, FECHA)
porBarrio2016 <- summarize(porBarrio2016, AÑO_2016 = n())
porBarrio2017 <- group_by(t2017, BARRIO, FECHA)
porBarrio2017 <- summarize(porBarrio2017, AÑO_2017 = n())
porBarrio2018 <- group_by(t2018, BARRIO, FECHA)
porBarrio2018 <- summarize(porBarrio2018, AÑO_2018 = n())
#Join de tablas
PorBarrioT <- merge(porBarrio2014, porBarrio2015, by = c("BARRIO","FECHA"), all = TRUE)
PorBarrioT <- merge(PorBarrioT, porBarrio2016, by = c("BARRIO","FECHA"), all = TRUE)
PorBarrioT <- merge(PorBarrioT, porBarrio2017, by = c("BARRIO","FECHA"), all = TRUE)
PorBarrioT <- merge(PorBarrioT, porBarrio2018, by = c("BARRIO","FECHA"))
PorBarrioT[is.na(PorBarrioT)] <- 0
return(PorBarrioT)
}
cargarComuna()
cargarBarrio()
DatosBarrio <- cargarBarrio()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosBarrio,k=99)
y_tr_pred<-predict(adv_knn,DatosBarrio)
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- merge(DatosComuna, y_tr_pred, by = c("COMUNA","FECHA"), all = TRUE)
comunaPred <- DatosComuna
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
View(comunaPred)
library(shiny)
library(dplyr)
library(caret)
# Define UI for application that draws a histogram
ui <- fluidPage(
# Application title
titlePanel("Old Faithful Geyser Data"),
# Sidebar with a slider input for number of bins
sidebarLayout(
sidebarPanel(
sliderInput("bins",
"Number of bins:",
min = 1,
max = 50,
value = 30)
),
# Show a plot of the generated distribution
mainPanel(
plotOutput("distPlot")
)
)
)
# Define server logic required to draw a histogram
server <- function(input, output) {
output$distPlot <- renderPlot({
# generate bins based on input$bins from ui.R
x    <- faithful[, 2]
bins <- seq(min(x), max(x), length.out = input$bins + 1)
# draw the histogram with the specified number of bins
hist(x, breaks = bins, col = 'darkgray', border = 'white')
})
}
# Run the application
shinyApp(ui = ui, server = server)
View(DatosComuna)
comunaPred["FECHA"] <- as.Date(comunaPred$FECHA, format="%m/%d")
View(comunaPred)
comunaPred["FECHA"] <- as.Date(comunaPred$FECHA, format="%m-%d")
View(comunaPred)
as.Date(comunaPred$FECHA, format="%m-%d")
as.Date("01-01", format="%m-%d")
as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred["FECHA"] <- strptime(comunaPred$FECHA,format="%m-%d")
strptime(comunaPred$FECHA,format="%m-%d")
####################################################################################################
strptime(comunaPred$FECHA,format="%m-%d")
as.Date(comunaPred$FECHA,format="%m-%d")
cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
View(comunaPred)
as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
View(comunaPred)
View(comunaPred)
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
View(comunaPred)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- format(as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d"), format="%m-%d")
View(DatosBarrio)
View(comunaPred)
format(comunaPred$FECHA, format="Week number %W of %Y")
format(comunaPred$FECHA, format="%W")
format(comunaPred$FECHA, format="%W")
format(comunaPred$FECHA, format="%w")
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
View(comunaPred)
format(comunaPred$FECHA, format="%w")
View(comunaPred)
format(comunaPred$FECHA, format="%W")
ComunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
View(comunaPred)
ComunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
ComunaPred$SEMANA <- format(comunaPred$FECHA, format="%W")
comunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
View(comunaPred)
View(DatosComuna)
View(comunaPred)
comunaPred <- group_by(SEMANA, COMUNA)
View(comunaPred)
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, AÑO_2014 = n(AÑO_2014))
comunaPred <- summarize(comunaPred, AÑO_2014 = sum(AÑO_2014))
View(comunaPred)
View(comunaPred)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
View(comunaPred)
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
View(comunaPred)
View(comunaPred)
View(comunaPred)
View(DatosComuna)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
1comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
View(comunaPred)
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, AÑO_2014 = sum(AÑO_2014))
View(comunaPred)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred["MES"] <- format(comunaPred$FECHA, format="%M")
comunaPred <- group_by(comunaPred, MES, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
View(comunaPred)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred["MES"] <- format(comunaPred$FECHA, format="%m")
comunaPred <- group_by(comunaPred, MES, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
View(comunaPred)
View(comunaPred)
comuna2018 <- function(tipo){
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred[tipo] <- format(comunaPred$FECHA, format="%m")
comunaPred <- group_by(comunaPred, tipo, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
return(comunaPred)
}
comuna2018("MES")
library(shiny)
library(dplyr)
library(caret)
comuna2018("MES")
comuna2018 <- function(tipo){
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
if(tipo == "MES"){
comunaPred["MES"] <- format(comunaPred$FECHA, format="%m")
}
comunaPred <- group_by(comunaPred, tipo, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
return(comunaPred)
}
comuna2018("MES")
if(tipo == "MES"){
comunaPred["MES"] <- format(comunaPred$FECHA, format="%m")
}
comunaPred <- group_by(comunaPred, MES, COMUNA)
if(tipo == "MES"){
comunaPred["MES"] <- format(comunaPred$FECHA, format="%m")
}
if(tipo == "MES"){
comunaPred["MES"] <- format(comunaPred$FECHA, format="%m")
}
comuna2018 <- function(tipo){
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
if(tipo == "MES"){
comunaPred["MES"] <- format(comunaPred$FECHA, format="%m")
}
comunaPred <- group_by(comunaPred, MES, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
return(comunaPred)
}
comuna2018("MES")
comuna2018 <- function(tipo){
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
comunaPred[tipo] <- format(comunaPred$FECHA, format="%m")
if(tipo == "MES"){
comunaPred <- group_by(comunaPred, MES, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
}else if(tipo == "SEMANA"){
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
}
return(comunaPred)
}
comuna2018("MES")
tablita <- comuna2018("MES")
View(tablita)
tablita <- comuna2018("SEMANA")
View(tablita)
comuna2018 <- function(tipo){
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["Año_pred"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
if(tipo == "MES"){
comunaPred[tipo] <- format(comunaPred$FECHA, format="%m")
comunaPred <- group_by(comunaPred, MES, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
}else if(tipo == "SEMANA"){
comunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, Año_pred = sum(Año_pred))
}
return(comunaPred)
}
tablita <- comuna2018("SEMANA")
View(tablita)
View(DatosComuna)
View(tablita)
comuna2018 <- function(tipo){
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["AÑO_2018_PRED"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
if(tipo == "MES"){
comunaPred[tipo] <- format(comunaPred$FECHA, format="%m")
comunaPred <- group_by(comunaPred, MES, COMUNA)
comunaPred <- summarize(comunaPred, AÑO_2018_PRED = sum(AÑO_2018_PRED))
}else if(tipo == "SEMANA"){
comunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, AÑO_2018_PRED = sum(AÑO_2018_PRED))
}
return(comunaPred)
}
tablita <- comuna2018("SEMANA")
View(tablita)
tablita <- comuna2018("MES")
View(tablita)
View(tablita)
tablita <- comuna2018("DIA")
View(tablita)
comuna2018 <- function(tipo){
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["AÑO_2018_PRED"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
if(tipo == "MES"){
comunaPred[tipo] <- format(comunaPred$FECHA, format="%m")
comunaPred <- group_by(comunaPred, MES, COMUNA)
comunaPred <- summarize(comunaPred, AÑO_2018_PRED = sum(AÑO_2018_PRED))
}else if(tipo == "SEMANA"){
comunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, AÑO_2018_PRED = sum(AÑO_2018_PRED))
}else if(tipo == "DIA"){
comunaPred <- select(comunaPred,1, 2, 8)
}
return(comunaPred)
}
tablita <- comuna2018("DIA")
View(tablita)
i
comuna2018 <- function(tipo){
DatosComuna <- cargarComuna()
adv_knn<-knnreg(AÑO_2018~AÑO_2014+AÑO_2015+AÑO_2016+AÑO_2017,data=DatosComuna,k=99)
y_tr_pred<-predict(adv_knn,DatosComuna)
comunaPred <- DatosComuna
comunaPred["AÑO_2018_PRED"] <- y_tr_pred
comunaPred["FECHA"] <- as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d")
if(tipo == "MES"){
comunaPred[tipo] <- format(comunaPred$FECHA, format="%m")
comunaPred <- group_by(comunaPred, MES, COMUNA)
comunaPred <- summarize(comunaPred, AÑO_2018_PRED = sum(AÑO_2018_PRED))
}else if(tipo == "SEMANA"){
comunaPred["SEMANA"] <- format(comunaPred$FECHA, format="%W")
comunaPred <- group_by(comunaPred, SEMANA, COMUNA)
comunaPred <- summarize(comunaPred, AÑO_2018_PRED = sum(AÑO_2018_PRED))
}else if(tipo == "DIA"){
comunaPred <- select(comunaPred,1, 2, 8)
comunaPred["FECHA"] <- format(as.Date(strptime(comunaPred$FECHA,format="%m-%d"), format="%m-%d"),format="%m-%d")
}
return(comunaPred)
}
tablita <- comuna2018("DIA")
View(tablita)
View(tablita)
